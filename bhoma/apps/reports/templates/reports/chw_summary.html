{% extends "reports/report_base.html" %}
{% load report_tags %}
{% load sync_log_tags %}
{% block page_javascripts %}
    {{ block.super }}
    {% if daily_case_data %}
    <script> 
		$(function () {
		    var case_data = {{ daily_case_data|safe }};
		    var totals = {{ total_case_data|safe }};
		    $.plot($("#case-plot"), [{data: totals, label: "total cases received"},
		                               {data: case_data, label: "daily cases sent to phone", yaxis: 2, lines: {show: false}, bars: { show: true }} 
                                       ], 
		              { xaxis: {mode: "time",
		                        minTickSize: [1, "day"]}, 
		                yaxis: {min: 0, tickFormatter: function (v, axis) { return v + " cases" }, minTickSize: 1},
                        y2axis: {min: 0, tickFormatter: function (v, axis) { return v +" cases/day" }, minTickSize: 1},
		                legend: { position: "nw" }, 
		                grid: { hoverable: true }, 
		                series: { lines: { show: true },
                                  points: { show: true }}
                       });
	    });
        
    </script>
    <script type="text/javascript">
        $(function() {
            $("#tabs").tabs();
        });
    </script> 
{% endif %}
{% endblock %}
{% block reportcontent %}
<form method="get" style="padding-bottom: 20px;">
<label for="chw" id="chw_label">Choose CHW: </label> 
<select name="chw" id="chw">
        <option value="" {% if not user_id %}selected="selected"{% endif %}>All users</option>
        {% for chw in chws %}
        <option value="{{ chw.get_id }}" {% if chw.get_id == chw_id %}selected="selected"{% endif %}>{{ chw.formatted_name }} ({{ chw.current_clinic_display}})</option>
        {% endfor %}
</select>
<input type="submit" value="Go!" />
</form>
{% if daily_case_data %}
<div id="tabs">
    <ul>
        <li><a href="#case-data">Cases sent to phones</a></li>
        <li><a href="#sync-logs">Sync logs</a></li>
        <li><a href="#punchcard">Punchcard</a></li>
    </ul>
    <div id="case-data">
	    <h3>Cases sent to phones</h3>
	    <div id="case-plot" style="width:910px;height:400px;"></div>
    </div>
    <div id="sync-logs">
        {% sync_logs_for_chw main_chw.get_id %}        
    </div>
    <div id="punchcard">
        {% if punchcard_url %}
            <img src="{{punchcard_url}}"></img>
        {% else %}
            <p>Sorry, no data found</p>
        {% endif %}
    </div>
</div> 
{% endif %}
{% endblock %}