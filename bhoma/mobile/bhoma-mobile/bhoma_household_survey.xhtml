<h:html xmlns="http://www.w3.org/2002/xforms"
        xmlns:h="http://www.w3.org/1999/xhtml"
        xmlns:ev="http://www.w3.org/2001/xml-events"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:jr="http://openrosa.org/javarosa">
<h:head>
  <h:title>BHOMA Household Survey</h:title>
  <model>
    <instance>
			<household_survey xmlns="http://cidrz.org/bhoma/household_survey">
        
        <Meta>
            <DeviceID />
            <TimeStart />
            <TimeEnd />
            <username />
            <user_id />
            <uid />
            <version />
            
            <clinic_id />
        </Meta>
        
        <!-- insert casexml block -->
        <!-- pre-loaded patient info from patient select module -->
				
        <household_name />

        <num_people_in_hh />
        <any_pregnant jr:template="">
			<clinic_visit />
			<clinic_plan />
			<edd />
			<problems />
			<create_referral />

      <refer />
		</any_pregnant>
        <any_sick jr:template="">
			<illness />
			<danger_signs />
			<clinic_visit />
			<clinic_meds />
			<chw_treatment />
			<chw_drugs />
			<create_referral />

      <refer />
		</any_sick>
		<num_under_five />
		<check_immun />
		<normal_growth />
		<create_referral />
		<visit_problems />
		<problem_type />
		<problem_detail />

    <alert_create_referrals />
		<survey_over />
		
			</household_survey>
		</instance>
	
	<bind nodeset="Meta/DeviceID" jr:preload="property" jr:preloadParams="DeviceID" />
    <bind nodeset="Meta/username" jr:preload="meta" jr:preloadParams="UserName" />
    <bind nodeset="Meta/user_id" jr:preload="meta" jr:preloadParams="UserID" />
    <bind nodeset="Meta/TimeStart" type="dateTime" jr:preload="timestamp" jr:preloadParams="start" />
    <bind nodeset="Meta/TimeEnd" type="dateTime" jr:preload="timestamp" jr:preloadParams="end" />
    <bind nodeset="Meta/uid" type="xsd:string" jr:preload="uid" jr:preloadParams="general" />
	<bind nodeset="Meta/version" jr:preload="meta" jr:preloadParams="AppVersion" />
    <bind nodeset="Meta/clinic_id" jr:preload="meta" jr:preloadParams="clinic_id" />
    
	<bind nodeset="num_people_in_hh" required="true()" type="int" constraint=". &lt; 30" jr:constraintMsg="Enter a value less than 30"/>
    <bind nodeset="any_pregnant/clinic_visit" required="true()" />
    <bind nodeset="any_pregnant/clinic_plan" relevant="../clinic_visit = 'n'" />
	<bind nodeset="any_pregnant/edd" type="date" constraint=". &lt; today() + 365 and . &gt; today() - 90" jr:constraintMsg="EDD Date not possible" />
    <bind nodeset="any_pregnant/problems" required="true()" />
    <bind nodeset="any_pregnant/create_referral" relevant="../problems = 'y'" />
    <bind nodeset="any_pregnant/refer" calculate="../create_referral = 'y'" />
    <bind nodeset="any_sick/illness" required="true()" />
	<bind nodeset="any_sick/danger_signs" required="true()" constraint="not(selected(., 'none') and count-selected(.) &gt; 1)" jr:constraintMsg="Cant select 'No Danger Signs' and another answer"/>
    <bind nodeset="any_sick/clinic_visit" required="true()" />	
	<bind nodeset="any_sick/clinic_meds" relevant="../clinic_visit = 'y'" />
    <bind nodeset="any_sick/chw_treatment" required="true()" />	
    <bind nodeset="any_sick/chw_drugs" relevant="../chw_treatment = 'y'" />
    <bind nodeset="any_sick/refer" calculate="../create_referral = 'y'" />
	<bind nodeset="num_under_five" type="int" required = "true()" constraint=". &lt; 30" jr:constraintMsg="Enter a value less than 30"/>
    <bind nodeset="check_immun" relevant="../num_under_five != '0'" />
	<bind nodeset="normal_growth" relevant="../num_under_five != '0'" />
	<bind nodeset="visit_problems" required="true()" />
	<bind nodeset="problem_type" relevant="../visit_problems = 'y'" />
	<bind nodeset="problem_detail" type="string" relevant="../problem_type = 'other'" />
  <bind nodeset="alert_create_referrals" relevant="checklist(1, -1, ../any_pregnant/refer) or checklist(1, -1, ../any_sick/refer) or ../create_referral = 'y'" />	

	</model>
</h:head>			
<h:body>

  <input ref="household_name">
    <label>Which household is this? (Village/Plot # or name of head of household)</label>
  </input>

  <input ref="num_people_in_hh">
    <label>How many people are in the household?</label>
  </input>
  
  <group>
  <label>Pregnant Woman</label>
  <repeat nodeset='any_pregnant'>

	  <select1 ref="clinic_visit">
		<label>Has she gone to the clinic yet?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>

	  <select1 ref="clinic_plan">
		<label>Does she plan to go to the clinic?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>

	  <input ref="edd">
		<label>When is the baby due?</label>
	  </input>

	  <select1 ref="problems">
		<label>Has she had any health problems with this pregnancy?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>
	  
	  <select1 ref="create_referral">
		<label>Would you like to refer them to the clinic?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>
  </repeat>
  </group>
  
  <group>
  <label>Sick Person</label>
  <repeat nodeset='any_sick'>

	  <select ref="illness">
		<label>Select the main illness</label>
		<item><label>Diarrhea</label><value>diarrhea</value></item>
		<item><label>Vomiting</label><value>vomiting</value></item>
		<item><label>HIV / AIDS</label><value>hiv_aids</value></item>
		<item><label>Measles</label><value>measles</value></item>
		<item><label>Malaria</label><value>malaria</value></item>
		<item><label>Cough / RTI</label><value>cough_rti</value></item>
		<item><label>Injury</label><value>injury</value></item>
		<item><label>Fever</label><value>fever</value></item>
		<item><label>Fatigue</label><value>fatigue</value></item>
		<item><label>Headache</label><value>headache</value></item>
		<item><label>Recent Stroke</label><value>stroke</value></item>
		<item><label>Malnutrition</label><value>malnutrition</value></item>
		<item><label>Infection</label><value>infection</value></item>
		<item><label>They don't know</label><value>they_dont_know</value></item>
		<item><label>Other</label><value>other</value></item>
	  </select>
	  
	  <select ref="danger_signs">
		<label>Select any danger signs present</label>
		<item><label>Respiratory Distress</label><value>resp_distress</value></item>
		<item><label>Convulsions</label><value>convulsion</value></item>
		<item><label>Lethargic \ Unconscious</label><value>lethargic</value></item>
		<item><label>Severe Pain</label><value>pain</value></item>
		<item><label>Fever</label><value>fever</value></item>
		<item><label>Vomits Everything</label><value>vomit</value></item>
		<item><label>No Danger Signs</label><value>none</value></item>
	  </select>
	  
	  <select1 ref="clinic_visit">
		<label>Have they gone to a health facility yet?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>

	  <select1 ref="clinic_meds">
		<label>Did they get any medications from the health facility?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>

	  <select1 ref="chw_treatment">
		<label>Have you given any medications?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>

	  <select ref="chw_drugs">
		<label>Select any medications you have given</label>
		<item><label>Acetylsalicylic Acid</label><value>acetylsalicylic</value></item>
		<item><label>Paracetamol</label><value>paracetamol</value></item>
		<item><label>Ferrous Sulphate</label><value>ferrous_sulphate</value></item>
		<item><label>Folic Acid</label><value>folic_acid</value></item>
		<item><label>Tetracycline</label><value>tetracycline</value></item>
		<item><label>Mebendazole</label><value>mebendazole</value></item>
		<item><label>Chlorohexidine</label><value>chlorohexidine</value></item>
		<item><label>ORS</label><value>ors</value></item>
	  </select>
	  
	  <select1 ref="create_referral">
		<label>Would you like to refer them to the clinic?</label>
		<item><label>Yes</label><value>y</value></item>
		<item><label>No</label><value>n</value></item>
	  </select1>
  </repeat>
  </group>
		
  <input ref="num_under_five">
    <label>How many children under five live in the house?</label>
  </input>

  <select1 ref="check_immun">
	<label>Are all child immunizations up to date?</label>
	<item><label>Yes</label><value>y</value></item>
	<item><label>No</label><value>n</value></item>
  </select1>
 
  <select1 ref="normal_growth">
	<label>Are all children growing or developing normally?</label>
	<item><label>Yes</label><value>y</value></item>
	<item><label>No</label><value>n</value></item>
  </select1>
  
  <select1 ref="create_referral">
	<label>Are you referring anyone else to the clinic?</label>
	<item><label>Yes</label><value>y</value></item>
	<item><label>No</label><value>n</value></item>
  </select1>
  
  <select1 ref="visit_problems">
	<label>Did you have any problems with this visit?</label>
	<item><label>Yes</label><value>y</value></item>
	<item><label>No</label><value>n</value></item>
  </select1>
  
  <select ref="problem_type">
	<label>Select any problems you had with this visit</label>
	<item><label>Travel time</label><value>travel</value></item>
	<item><label>Discussing personal or sensitive health issues</label><value>sensitive_issues</value></item>
	<item><label>Doing a physical exam on patients</label><value>physical_exam</value></item>
	<item><label>Unsure of needed treatment or next step for an illness</label><value>unsure</value></item>
	<item><label>My medical kit was not designed with a needed item</label><value>med_kit_design</value></item>
	<item><label>My medical kit ran out of an item that it was designed with</label><value>med_kit_stock</value></item>
	<item><label>Not enough time for the visit</label><value>time</value></item>
	<item><label>The patient refused referral</label><value>refused</value></item>
	<item><label>Other</label><value>other</value></item>
  </select>
  
  <input ref="problem_detail">
    <label>Please describe your other problem</label>
  </input>

  <trigger ref="alert_create_referrals">
	<label>Remember to fill out the 'refer to clinic' form for each person you are referring to the clinic</label>
  </trigger>

  <trigger ref="survey_over">
	<label>Thank you! The household visit form is complete.</label>
  </trigger>
  
</h:body>
</h:html>
