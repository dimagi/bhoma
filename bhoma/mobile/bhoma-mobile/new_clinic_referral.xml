<h:html xmlns="http://www.w3.org/2002/xforms"
        xmlns:h="http://www.w3.org/1999/xhtml"
        xmlns:ev="http://www.w3.org/2001/xml-events"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:jr="http://openrosa.org/javarosa">
<h:head>
  <h:title>New Referral to Clinic</h:title>
  <model>
	<instance>
	  <clinic_refer xmlns="http://cidrz.org/bhoma/new_clinic_referral">
        
        <Meta>
            <DeviceID />
            <TimeStart />
            <TimeEnd />
            <username />
            <user_id />
            <uid />
        </Meta>
        
		<fname />
		<lname />
		<sex />
		<dob />
		<dob_est />
		<village />
		<contact />
		<life_threatening />
		<complaint />
		
		<chw_referral_id />
		<info_ref_id />
		<appt_date />
		
		<info_done />
		
	  </clinic_refer>
	</instance>
	
	<bind nodeset="Meta/DeviceID" jr:preload="property" jr:preloadParams="DeviceID" />
    <bind nodeset="Meta/username" jr:preload="meta" jr:preloadParams="UserName" />
    <bind nodeset="Meta/user_id" jr:preload="meta" jr:preloadParams="UserID" />
    <bind nodeset="Meta/TimeStart" type="dateTime" jr:preload="timestamp" jr:preloadParams="start" />
    <bind nodeset="Meta/TimeEnd" type="dateTime" jr:preload="timestamp" jr:preloadParams="end" />
	<bind nodeset="Meta/uid" type="xsd:string" jr:preload="uid" jr:preloadParams="general" />
		
	<bind nodeset="fname" required="true()" />
	<bind nodeset="lname" required="true()" />
	<bind nodeset="sex" required="true()" />
	<bind nodeset="dob" type="date" required="true()" constraint=". &lt;= today()" jr:constraintMsg="birthdate must be in past" />
	<bind nodeset="dob_est" required="true()" />
	<bind nodeset="village" required="true()" />
	<bind nodeset="contact" type="float" />
	<bind nodeset="life_threatening" required="true()" />

	<bind nodeset="chw_referral_id" calculate="chw-referral-num()" />
	<bind nodeset="appt_date" type="date" constraint=". &gt;= today() and . &lt;= (today() + 42)" jr:constraintMsg="must be within the next 6 weeks" />

  </model>
  
</h:head>			
<h:body>

  <input ref="fname">
  	<label>First Name</label>
  </input>

  <input ref="lname">
  	<label>Last Name</label>
  </input>

  <select1 ref="sex">
  	<label>Sex</label>
  	<item><label>Male</label><value>m</value></item>
  	<item><label>Female</label><value>f</value></item>
  </select1>  

  <input ref="dob">
  	<label>Date of Birth</label>
  </input>

  <select1 ref="dob_est">
  	<label>Is date of birth estimated?</label>
  	<item><label>No</label><value>n</value></item>
  	<item><label>Yes</label><value>y</value></item>
  </select1>  

  <input ref="village">
  	<label>Village</label>
  </input>
  
  <input ref="contact">
  	<label>Phone # to be reached at, if any</label>
  </input>

  <input ref="complaint">
    <label>What is the patient's health problem? (optional)</label>
  </input>

  <select1 ref="life_threatening">
  	<label>Is patient's issue life-threatening?</label>
  	<item><label>No</label><value>n</value></item>
  	<item><label>Yes</label><value>y</value></item>
  </select1>  
  
  <trigger ref="info_ref_id">
  	<label>The referral code is: <output value="../chw_referral_id" />. Give this number to the patient to bring with them to the clinic.</label>
  </trigger>

  <input ref="appt_date">
  	<label>What day does the patient expect to go to the clinic? (skip if they don't know)</label>
  </input>

  <trigger ref="info_done">
  	<label>This patient has been referred. The clinic will expect them on or around the given appointment date.</label>
  </trigger>

</h:body>
</h:html>
