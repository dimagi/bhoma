<h:html xmlns="http://www.w3.org/2002/xforms"
        xmlns:h="http://www.w3.org/1999/xhtml"
        xmlns:ev="http://www.w3.org/2001/xml-events"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:jr="http://openrosa.org/javarosa">
<h:head>
  <h:title>BHOMA Antenatal Care</h:title>
  <model>
		<instance>
			<pregnancy xmlns="http://cidrz.org/bhoma/pregnancy" version="2">
        
        <Meta>
            <clinic_id />
            <TimeStart />
            <TimeEnd />
            <username />
            <user_id />
            <uid />
        </Meta>
        
        <case>
            <patient_id></patient_id> <!-- preloaded -->
            <case_id></case_id> <!-- preloaded -->
            <bhoma_case_id></bhoma_case_id> <!-- preloaded -->
            <case_type></case_type> <!-- diagnosis -->
            <followup_type></followup_type> <!-- referral, chw followup, facility followup, closed -->
            <followup_date></followup_date> <!-- generated by form or empty (in days) -->
        </case>
        
        
        <!-- pre-loaded patient info from patient select module -->
				
        <visit_number />
        <first_visit>
          <height />
          <num_pregs />
          <num_births />
          <num_children />
          <past_complications />
          <past_caesarean />
          <lmp />
          <edd />
        </first_visit>        
        <encounter_date />
        <gestational_age />
        <blood_pressure />
        <weight />
        <fetal_heart_rate />
        <fundal_height />
        <presentation />
		<pallor />
        <danger_signs />
        <urinalysis_protein />
		<urinalysis_glucose />
		<urinalysis_wbc />
        <hgb />
		<hiv_result />
		<hiv_partner />
		<cd4_possible />
        <cd4 />
        <on_haart />
        <pmtct />
        <rpr />
        <checklist />
		<itn />
		<fp_if_counseling />
        <next_visit />

			</pregnancy>
		</instance>

    <bind nodeset="Meta/clinic_id" jr:preload="meta" jr:preloadParams="clinic_id" />
    <bind nodeset="Meta/username" jr:preload="meta" jr:preloadParams="username" />
    <bind nodeset="Meta/user_id" jr:preload="meta" jr:preloadParams="user_id" />
    <bind nodeset="Meta/TimeStart" type="dateTime" jr:preload="timestamp" jr:preloadParams="start" />
    <bind nodeset="Meta/TimeEnd" type="dateTime" jr:preload="timestamp" jr:preloadParams="end" />
    <bind nodeset="Meta/uid" type="xsd:string" jr:preload="uid" jr:preloadParams="general" />
    		
    <bind nodeset="case/patient_id" type="xsd:string" jr:preload="case" jr:preloadParams="patient_id" />
    <bind nodeset="case/case_id" type="xsd:string" jr:preload="case" jr:preloadParams="case_id" />
    <bind nodeset="case/bhoma_case_id" type="xsd:string" jr:preload="case" jr:preloadParams="bhoma_case_id" />
    <bind nodeset="case/case_type" type="xsd:string" /> <!-- TODO: calculate -->
    <bind nodeset="case/followup_type" type="xsd:string" />
    <bind nodeset="case/followup_date" type="int" /> <!-- TODO: calculate -->
    
    <bind nodeset="visit_number" required="true()" />
    <bind nodeset="first_visit" relevant="../visit_number = '1'" />
    <bind nodeset="first_visit/height" type="int" constraint=". &gt;= 25 and . &lt;= 250" jr:constraintMsg="Height should be between 25 cm and 250 cm" /> <!-- soft constraint? -->
    <bind nodeset="first_visit/num_pregs" type="int" constraint=". &lt; 30" jr:constraintMsg="Enter a value less than 30" />
    <bind nodeset="first_visit/num_births" type="int" relevant="../num_pregs &gt; 0" constraint=". &lt; 30" jr:constraintMsg="Enter a value less than 30" />
    <bind nodeset="first_visit/num_children" type="int" relevant="../num_pregs &gt; 0" constraint=". &lt; 30" jr:constraintMsg="Enter a value less than 30" />
    <bind nodeset="first_visit/past_complications" required="true()" relevant="../num_pregs &gt; 0" />
    <bind nodeset="first_visit/past_caesarean" required="true()" relevant="../num_pregs &gt; 0" />
    <bind nodeset="first_visit/lmp" type="date" />
    <bind nodeset="first_visit/edd" type="date" />
    <bind nodeset="encounter_date" type="date" required="true()" jr:preload="date" jr:preloadParams="today" />
    <bind nodeset="gestational_age" type="int" constraint=". &lt; 45" jr:constraintMsg="Gestation Age should be less than 45 weeks"/>
    <bind nodeset="blood_pressure" type="string" constraint="true()" />
    <bind nodeset="weight" type="decimal" constraint=". &lt;= 250" jr:constraintMsg="Weight should be less than 250 kg"/>
    <bind nodeset="fetal_heart_rate" type="int" constraint=". &lt; 300" jr:constraintMsg="Fetal Heart Rate should be less than 300"/>
    <bind nodeset="fundal_height" type="int" constraint=". &lt; 50" jr:constraintMsg="Fundal Height should be less than 50 cm"/>
	<bind nodeset="presentation" required="true()" />
	<bind nodeset="pallor" required="true()" />	
	<bind nodeset="danger_signs" required="true()" constraint="not((selected(., 'none') or selected(., 'blank')) and count-selected(.) &gt; 1)" jr:constraintMsg="Cant select 'No Danger Signs' or 'Question Left Blank' and another answer" />
	<bind nodeset="urinalysis_protein" required="true()" />
 	<bind nodeset="urinalysis_glucose" required="true()" />
	<bind nodeset="urinalysis_wbc" required="true()" />
	<bind nodeset="hgb" type="int" relevant="../pallor = 'sev' or ../pallor = 'mod'" constraint=". &lt;= 25" jr:constraintMsg="Hgb should be less than 25 (g/dL)" />
	<bind nodeset="hiv_result" required="true()" />
	<bind nodeset="hiv_partner" required="true()" />
	<bind nodeset="cd4_possible" required="true()" relevant="../hiv_result != 'nr'" />
    <bind nodeset="cd4" type="int" relevant="../cd4_possible = 'results'" constraint=". &lt;= 3000" jr:constraintMsg="CD4 count should be less than 3000 (cells/mm3)" />
    <bind nodeset="on_haart" required="true()" relevant="../hiv_result != 'nr' and ../hiv_result != 'nd'" />
	<bind nodeset="pmtct" required="true()" relevant="../hiv_result != 'nr'" constraint="not((selected(., 'blank')) and count-selected(.) &gt; 1)" jr:constraintMsg="Cant select 'Question Left Blank' and another answer" />
	<bind nodeset="rpr" required="true()" />
	<bind nodeset="checklist" constraint="not((selected(., 'none')) and count-selected(.) &gt; 1)" jr:constraintMsg="Cant select 'None of the Above' and another answer" />
	<bind nodeset="itn" required="true()" />
	<bind nodeset="fp_if_counseling" required="true()" />
	<bind nodeset="next_visit" type="date" jr:preload="date" jr:preloadParams="today" />

	</model>
</h:head>			
<h:body>
	
  <select1 ref="visit_number">
    <label>Which # Visit is This?</label>
    <item><label>1</label><value>1</value></item>
    <item><label>2</label><value>2</value></item>
    <item><label>3</label><value>3</value></item>
    <item><label>4</label><value>4</value></item>
    <item><label>5</label><value>5</value></item>
    <item><label>6</label><value>6</value></item>
	<item><label>7</label><value>7</value></item>
	<item><label>8</label><value>8</value></item>
    <item><label>Other</label><value>other</value></item>
	<hint> Please select the appropriate visit number </hint>
  </select1>

  <input ref="first_visit/height" appearance="unit: cm;">
    <label>Enter Patient Height</label>
	<hint> This is Height measured in Centimeters </hint>
  </input>
  
  <input ref="first_visit/num_pregs">
    <label>Enter Number of Previous Pregnancies</label>
  </input>

  <input ref="first_visit/num_births">
    <label>Enter Number of Previous Live Births</label>
	<hint> Enter all previous live births </hint>
  </input>

  <input ref="first_visit/num_children">
    <label>Enter Number of Living Children</label>
  </input>

  <select1 ref="first_visit/past_complications">
    <label>Have Any Past Pregnancies had Complications?</label>
    <item><label>Yes</label><value>y</value></item>
    <item><label>No</label><value>n</value></item>
	<item><label>Question Left Blank</label><value>blank</value></item>
  </select1>

  <select1 ref="first_visit/past_caesarean">
    <label>Were any of the past deliveries by Caesarean?</label>
    <item><label>Yes</label><value>y</value></item>
    <item><label>No</label><value>n</value></item>
	<item><label>Question Left Blank</label><value>blank</value></item>
  </select1>

  <input ref="first_visit/lmp" appearance="before: 310; after: 1;">
    <label>Enter Last Menstrual Period (LMP)</label>
	<hint> The LMP is the date of onset of the last menstrual period. Record the patient's LMP in the format of Day / Month/ Year </hint>
  </input>

  <input ref="first_visit/edd" appearance="before: 120; after: 365;">
    <label>Enter Expected Delivery Date (EDD)</label>
  </input>

  <input ref="encounter_date" appearance="before: 120; after: 1;">
    <label>Enter Visit Date</label>
  </input>
  
  <input ref="gestational_age" appearance="unit: weeks;">
    <label>Enter Gestational Age</label>
  </input>

  <input ref="blood_pressure" appearance="domain: bp;">
    <label>Enter Blood Pressure</label>
	<hint> Blood pressure should be recorded on the form as systolic pressure over diastolic pressure. </hint>
  </input>

  <input ref="weight"  appearance="unit: kg;">
    <label>Enter Maternal Weight</label>
	<hint> Enter weight in Kilograms</hint>
  </input>

  <input ref="fetal_heart_rate" appearance="unit: b/min;">
    <label>Enter Fetal Heart Rate</label>
	<hint> Record the fetal heart rate in beats per minute.</hint>
  </input>

  <input ref="fundal_height" appearance="unit: cm;">
    <label>Enter Fundal Height</label>
	<hint> Record the fundal height in centimeters.</hint>
  </input>

  <select1 ref="presentation">
    <label>Select Presentation</label>
    <item><label>Breech</label><value>breech</value></item>
    <item><label>Cephalic</label><value>cephalic</value></item>
	<item><label>Question Left Blank</label><value>blank</value></item>
  </select1>

  <select1 ref="pallor">
    <label>Select Pallor</label>
    <item><label>Severe</label><value>sev</value></item>
    <item><label>Moderate</label><value>mod</value></item>
	<item><label>None</label><value>none</value></item>
	<item><label>Question Left Blank</label><value>blank</value></item>
  </select1>

  <select ref="danger_signs" appearance="as-select1: 7, 8;">
    <label>Select Any Danger Signs Present</label>
    <item><label>Vaginal Bleeding</label><value>bleeding</value></item>    
    <item><label>Draining</label><value>draining</value></item>    
    <item><label>Contractions</label><value>contract</value></item>    
    <item><label>Pain Urination</label><value>pain_urinating</value></item>     
    <item><label>Oedema</label><value>oedema</value></item>
    <item><label>Low Fetal Movement</label><value>low_movement</value></item>   
	<item><label>No Danger Signs</label><value>none</value></item>
	<item><label>Question Left Blank</label><value>blank</value></item>
	<hint> Select all danger signs that the patient is presenting</hint>
  </select>
  
  <select1 ref="urinalysis_protein">
    <label>Select Urinalysis Protein &#x2265; 2+</label>
    <item><label>Positive</label><value>p</value></item>
    <item><label>Negative</label><value>n</value></item>
	<item><label>Not Done</label><value>nd</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>
  </select1>
  
  <select1 ref="urinalysis_glucose">
    <label>Select Urinalysis Glucose</label>
    <item><label>Positive</label><value>p</value></item>
    <item><label>Negative</label><value>n</value></item>
	<item><label>Not Done</label><value>nd</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>
  </select1>
    
  <select1 ref="urinalysis_wbc">
    <label>Select Urinalysis WBC</label>
    <item><label>Positive</label><value>p</value></item>
    <item><label>Negative</label><value>n</value></item>
	<item><label>Not Done</label><value>nd</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>
  </select1>
  
  <input ref="hgb"  appearance="unit: g/dL;">
    <label>Enter Hgb Amount</label>
	<hint> Enter the Hgb Amount</hint>
  </input>
  
  <select1 ref="hiv_result">
    <label>Select Result of HIV Test</label>
    <item><label>Reactive</label><value>r</value></item>
    <item><label>Not Reactive</label><value>nr</value></item>
	<item><label>Not Done</label><value>nd</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>	
  </select1>

  <select1 ref="hiv_partner">
    <label>Select Result of Partner HIV Test</label>
    <item><label>Reactive</label><value>r</value></item>
    <item><label>Not Reactive</label><value>nr</value></item>
	<item><label>Not Done</label><value>nd</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>	
  </select1>

  <select1 ref="cd4_possible">
    <label>CD4 Test</label>
    <item><label>Test Ordered</label><value>ordered</value></item>
    <item><label>Test Results Entered</label><value>results</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>	
  </select1>
  
  <input ref="cd4" appearance="unit: cells/mm3;">
	<label>Enter Results of CD4 Test</label>
  </input>

  <select1 ref="on_haart">
    <label>Is the Patient on HAART?</label>
    <item><label>Yes</label><value>y</value></item>
    <item><label>No</label><value>n</value></item>
	<item><label>Question Left Blank</label><value>blank</value></item>	
  </select1>

  <select ref="pmtct" appearance="as-select1: 3;">
    <label>Select PMTCT Medicine Given?</label>
    <item><label>AZT</label><value>azt</value></item>
    <item><label>NVP</label><value>nvp</value></item>
	<item><label>Question Left Blank</label><value>blank</value></item>	
  </select>

  <select1 ref="rpr">
    <label>Select Result of RPR Test</label>
    <item><label>Reactive</label><value>r</value></item>
    <item><label>Not Reactive</label><value>nr</value></item>
	<item><label>Not Done</label><value>nd</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>	
  </select1>

  <select ref="checklist" appearance="as-select1: 7;">
    <label>Tick All Items that Apply to this Visit</label>
    <item><label>Penicillin</label><value>penicillin</value></item>
    <item><label>Partner Penicillin</label><value>partner_penicillin</value></item>
    <item><label>TT</label><value>tt</value></item>
    <item><label>Fansidar</label><value>fansidar</value></item>
    <item><label>Mebendazole</label><value>mebendazole</value></item>
    <item><label>Iron / Folate</label><value>iron_folate</value></item>
	<item><label>None of the Above Ticked</label><value>none</value></item>
  </select>

  <select1 ref="itn">
    <label>Does the Patient Sleep Under an ITN?</label>
    <item><label>Yes</label><value>y</value></item>
    <item><label>No</label><value>n</value></item>
    <item><label>Question Left Blank</label><value>blank</value></item>	
  </select1>
  
  <select1 ref="fp_if_counseling">
    <label>Did the Patient Recieve FP/IF Counseling?</label>
    <item><label>Yes</label><value>y</value></item>
    <item><label>Left Blank</label><value>blank</value></item>	
  </select1>
  
  <input ref="next_visit" appearance="before: 120; after: 180;">
    <label>Next visit scheduled for...</label>
  </input>

</h:body>
</h:html>
