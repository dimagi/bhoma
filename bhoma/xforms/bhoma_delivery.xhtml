<h:html xmlns="http://www.w3.org/2002/xforms"
        xmlns:h="http://www.w3.org/1999/xhtml"
        xmlns:ev="http://www.w3.org/2001/xml-events"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:jr="http://openrosa.org/javarosa">
<h:head>
  <h:title>BHOMA Delivery</h:title>
  <model>
		<instance>
			<delivery xmlns="http://cidrz.org/bhoma/delivery">
        
        <Meta>
            <clinic_id />
            <TimeStart />
            <TimeEnd />
            <username />
            <user_id />
            <uid />
        </Meta>
        
        <case>
            <patient_id></patient_id> <!-- preloaded -->
            <case_type></case_type> <!-- diagnosis -->
            <followup_type></followup_type> <!-- referral, chw followup, facility followup, closed -->
            <followup_date></followup_date> <!-- generated by form or empty (in days) -->
            <outcome></outcome> <!-- how the case was closed -->
        </case>
        
        <!-- pre-loaded patient info from patient select module -->
				
        <encounter_date />
        <diagnosis />
        <date_of_birth />
        <time_of_birth />
        <sex />
        <birth_weight />
        <uterotonic />
        <delivery_method />
        <complications />
        <resolution />
        <followup_days />
        <outcome />
			</delivery>
		</instance>
	
    <bind nodeset="Meta/clinic_id" jr:preload="meta" jr:preloadParams="clinic_id" />
    <bind nodeset="Meta/username" jr:preload="meta" jr:preloadParams="username" />
    <bind nodeset="Meta/user_id" jr:preload="meta" jr:preloadParams="user_id" />
    <bind nodeset="Meta/TimeStart" type="dateTime" jr:preload="timestamp" jr:preloadParams="start" />
    <bind nodeset="Meta/TimeEnd" type="dateTime" jr:preload="timestamp" jr:preloadParams="end" />
    <bind nodeset="Meta/uid" type="xsd:string" jr:preload="uid" jr:preloadParams="general" />
    
    <bind nodeset="case/patient_id" type="xsd:string" jr:preload="case" jr:preloadParams="patient_id" />
    <bind nodeset="case/case_type" type="xsd:string" calculate="../../diagnosis"/>
    <bind nodeset="case/followup_type" type="xsd:string" calculate="../../resolution"/>
    <bind nodeset="case/followup_date" type="int" calculate="../../followup_days"/>
    <bind nodeset="case/outcome" type="int" calculate="../../outcome"/>
        
    <bind nodeset="encounter_date" type="date" required="true()" jr:preload="date" jr:preloadParams="today" constraint=". &lt;= today() + 1 and . &gt;= today() - 30" jr:constraintMsg="Must be within recent past" />
    <bind nodeset="date_of_birth" type="date" constraint=". &lt;= today() + 1" jr:constraintMsg="Cannot be in future" jr:preload="date" jr:preloadParams="today" />
    <bind nodeset="time_of_birth" type="int" constraint=". &lt;= 2359" /> <!-- need to support a real time widget -->
    <bind nodeset="birth_weight" type="decimal" constraint=". &lt;= 10" jr:constraintMsg="Weight should be less than 10 kgs" />
    <bind nodeset="resolution" required="true()" />
    <bind nodeset="followup_days" type="int" relevant="../resolution = 'followup-clinic' or ../resolution = 'followup-chw'" />   
    <bind nodeset="outcome" relevant="../resolution = 'closed'" />

	</model>
</h:head>			
<h:body>

  <input ref="encounter_date">
    <label>Enter Date of Visit</label>
  </input>
	
  <select1 ref="diagnosis">
    <label>Select Diagnosis</label>
    <item><label>False Labour</label><value>false_labour</value></item>
    <item><label>True Labour</label><value>true_labour</value></item>
    <item><label>Latent Labour</label><value>latent_labour</value></item>
    <item><label>Pre-eclampsia/Hypertension</label><value>eclampsia</value></item>
    <item><label>Other</label><value>other</value></item>
  </select1>

  <input ref="date_of_birth">
    <label>Enter Date of Delivery</label>
  </input>

  <input ref="time_of_birth">
    <label>Enter Time of Birth (HHMM)</label>
  </input>

  <select1 ref="sex">
    <label>Select Infant's Gender</label>
    <item><label>Male</label><value>m</value></item>
    <item><label>Female</label><value>f</value></item>
  </select1>

  <input ref="birth_weight">
    <label>Enter Birth Weight (kg)</label>
  </input>

  <select1 ref="uterotonic">
    <label>Select Uterotonic</label>
    <item><label>None</label><value>none</value></item>
    <item><label>Oxytocin</label><value>oxy</value></item>
    <item><label>Ergometrine</label><value>ergo</value></item>
    <item><label>Cytotec</label><value>cyto</value></item>
    <item><label>Synthometrin</label><value>syntho</value></item>
  </select1>

  <select1 ref="delivery_method">
    <label>Select Delivery Method</label>
    <item><label>Spontaneous Vaginal</label><value>vaginal</value></item>
    <item><label>Caesarian</label><value>caesarian</value></item>
    <item><label>Vacuum</label><value>vacuum</value></item>
    <item><label>Forceps</label><value>forceps</value></item>
    <item><label>Breech</label><value>breech</value></item>
  </select1>

  <select1 ref="complications">
    <label>Were there Complications?</label>
    <item><label>Yes</label><value>y</value></item>
    <item><label>No</label><value>n</value></item>
  </select1>

  <select1 ref="resolution">
    <label>What is the Conclusion of this Case?</label>
    <item><label>Referral to Hospital / Specialist</label><value>referral</value></item>
    <item><label>Follow Up with the Health Facility</label><value>followup-clinic</value></item>
    <item><label>Follow Up with CHW</label><value>followup-chw</value></item>
    <item><label>Case Closed in Clinic</label><value>closed</value></item>
  </select1>

  <input ref="followup_days">
    <label>Follow up in how many days?</label>
  </input>

  <select1 ref="outcome">
    <label>Case closed outcome</label>
    <item><label>Uncomplicated term, SVD, live birth</label><value>uncomplicated_term_svd_live_birth</value></item>
    <item><label>Pre-term, SVD, live birth managed</label><value>preterm_svd_live_birth_managed</value></item>
    <item><label>Intrapartum (pre-)eclampsia managed</label><value>intrapartum_eclampsia_managed</value></item>
    <item><label>Prolonged labor managed</label><value>prolonged_labor_managed</value></item>
    <item><label>Intrapartum hemorrhage managed</label><value>intrapartum_hemorrhage_managed</value></item>
    <item><label>Intrapartum infection treated</label><value>intrapartum_infection_treated</value></item>
    <item><label>Pre-term delivery, still birth (MSB/FSB)</label><value>preterm_delivery_still_birth</value></item>
    <item><label>Prolonged delivery, still birth (MSB/FSB)</label><value>prolonged_delivery_still_birth</value></item>
    <item><label>Maternal death, baby alive</label><value>maternal_death baby_alive</value></item>
    <item><label>Maternal and fetal death</label><value>maternal_and_fetal_death</value></item>
    <item><label>Unknown</label><value>unknown</value></item>
    <item><label>Other</label><value>other</value></item>
  </select1>

</h:body>
</h:html>
